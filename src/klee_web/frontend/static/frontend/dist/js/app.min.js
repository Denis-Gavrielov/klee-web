var services=angular.module("services",["ngResource"]);services.factory("Project",["$resource",function(a){return a("/api/projects/:id",{id:"@id"},{update:{method:"PUT"}})}]),services.factory("File",["$resource",function(a){return a("/api/projects/:projectId/files/:fileId",{projectId:"@projectId",fileId:"@id"},{update:{method:"PUT"}})}]);var controllers=angular.module("controllers",[]);controllers.controller("MainCtrl",["$scope","$http","$rootScope","Project","File","$interval",function(a,b,c,d,e,f){a.submission={name:null,code:""},a.opts={symArgs:!1,symFiles:!1,symIn:!1,options:!1,arguments:!1},a.config={symArgs:{range:[0,0],size:0},symFiles:{num:0,size:0},symIn:{size:0},options:"",arguments:""},a.submission.runConfiguration=angular.copy(a.config),a.defaultSubmission=angular.copy(a.submission),a.progress=[],a.result={},a.submitted=!1,a.editor=null,a.selectedProject=null,a.projects=[],a.files=[],a.toggleSymArgs=function(b){b.preventDefault(),b.stopPropagation(),a.opts.symArgs=!a.opts.symArgs},a.toggleSymFiles=function(b){b.preventDefault(),b.stopPropagation(),a.opts.symFiles=!a.opts.symFiles},a.toggleSymIn=function(b){b.preventDefault(),b.stopPropagation(),a.opts.symIn=!a.opts.symIn},a.toggleOptions=function(b){b.preventDefault(),b.stopPropagation(),a.opts.options=!a.opts.options,a.opts.arguments=!a.opts.arguments},a.resetLoadedFile=function(){a.submission=angular.copy(a.defaultSubmission)};var g=null,h=0;const i=2e3;var j=function(){var b=a.submission;angular.isUndefined(a.submission.$update)||a.selectedProject.example||e.update({},b),h=Date.now(),g=null};a.$watch("submission",function(a,b){if(a!==b&&null==g){var c=h+i-Date.now(),d=Math.max(c,0);g=setTimeout(j,d)}},!0);var k=function(){for(opt in a.opts)a.submission.runConfiguration[opt]=a.opts[opt]?a.config[opt]:a.defaultSubmission.runConfiguration[opt]};a.processForm=function(d){k(),c.startNanobar(),a.submitted=!0,a.result={},a.progress=[],a.progress.push("Job queued!"),b.post("/api/jobs/submit/",d).success(function(d,e,g){taskId=d.taskId;var h=f(function(){b.get("/jobs/status/"+taskId+"/").success(function(b,d,e){m=angular.fromJson(b);var g=m.type;"notification"==g?(b=angular.fromJson(m.data),a.progress.push(b.message)):(a.submitted=!1,b=angular.fromJson(m.data),"job_complete"==g&&a.progress.push("Done!"),a.result=b,c.finishNanobar(),f.cancel(h))})},1e3)}).error(function(a,b,d){console.debug("Error! ",a),c.finishNanobar()})},a.codemirrorLoaded=function(b){a.editor=b,b.setOption("viewportMargin",5),b.setOption("lineWrapping",!0),b.setOption("lineNumbers",!0),b.setOption("mode",{name:"text/x-csrc",useCPP:!0}),b.setOption("readOnly","nocursor"),b.setOption("theme","neo")},a.drawCoverage=function(b){a.editor.setValue(a.submission.code);for(var c=0,d=0,e=b.lines,f=0;f<e.length;f++){var g=e[f].hit;null==g?a.editor.addLineClass(f,"wrap","line-null"):(g>0?(c+=1,a.editor.addLineClass(f,"wrap","line-hit")):a.editor.addLineClass(f,"wrap","line-miss"),d+=1)}a.editor.addLineClass(e.length,"wrap","line-null"),a.linePercentage=100*(c/d).toFixed(2),a.editor.focus()},a.$watch("result",function(b){angular.isUndefined(b.coverage)||null===b.coverage||a.drawCoverage(b.coverage[0])})}]),controllers.controller("EditorCtrl",["$scope",function(a){a.editorOptions={viewportMargin:5,lineWrapping:!0,lineNumbers:!0,mode:{name:"text/x-csrc",useCPP:!0},theme:"neo"}}]),controllers.controller("SidebarCtrl",["$scope","Project","File","FileUploader","$cookies",function(a,b,c,d,e){function f(b,d){var e=c.query({projectId:b}).$promise;e.then(function(b){a.files=b;var c=_.findWhere(a.files,{id:d});a.selectFile(c)})}a.projectToAdd=!1,a.newFile={name:"",showForm:!1},a.newProjectOpt={name:"Add New Project",auth:!1},a.uploader=new d({withCredentials:!0,autoUpload:!0,removeAfterUpload:!0,headers:{"X-CSRFToken":e.csrftoken},onSuccessItem:function(b,c,d,e){f(a.selectedProject.id,c.id)},onErrorItem:function(a,b,c,d){alert("Upload failed. Please make sure you're uploading a valid file and try again.")}}),b.query().$promise.then(function(b){a.projects=b,a.projects.push(a.newProjectOpt),b.length>0&&(a.$parent.selectedProject=b[0])}),a.$watch("selectedProject",function(b){_.isNull(b)||_.isUndefined(b)?(a.files=[],a.resetLoadedFile()):"Add New Project"==b.name?a.projectToAdd=!0:(a.uploader.url="api/projects/"+b.id+"/files/upload/",f(b.id,b.defaultFile))}),a.selectFile=function(b){if(angular.isUndefined(b))a.resetLoadedFile();else{var c=a.$parent.selectedProject;a.$parent.submission=b,c.defaultFile=b.id;for(opt in a.opts)b.runConfiguration[opt].size&&(a.opts[opt]=!0);a.$parent.config=b.runConfiguration,c.example||c.$update()}},a.resetProjectSelector=function(){a.projectToAdd=!1,a.$parent.selectedProject=null},a.addProject=function(c){var d=new b({name:c});d.$save(function(b){a.projects.push(b),a.$parent.selectedProject=b,a.projectToAdd=!1})},a.showAddFile=function(){a.newFile.showForm=!0},a.addFile=function(){var b=a.newFile.name,d=/\.c$/;d.test(b)||(b+=".c");var e=new c({projectId:a.$parent.selectedProject.id,name:b,code:"// Edit "+b,runConfiguration:{symArgs:{range:[0,0],size:0},symFiles:{num:0,size:0},symIn:{size:0},options:"",arguments:""}});e.$save(function(b){a.files.unshift(b),a.newFile.name="",a.newFile.showForm=!1,a.selectFile(e)})},a.deleteFile=function(b){b.$delete(function(){b==a.submission&&a.resetLoadedFile(),a.files=_.without(a.files,b)})}}]),controllers.controller("ResultTabsCtrl",["$scope",function(a){a.tabs={output:{active:!0},stats:{active:!1},coverage:{active:!1}},a.hideAllTabs=function(){angular.forEach(a.tabs,function(b,c){a.tabs[c].active=!1})},a.setTab=function(b){b in a.tabs&&(a.hideAllTabs(),a.tabs[b].active=!0)},a.$watch("submitted",function(b){b&&a.setTab("output")})}]);var directives=angular.module("directives",[]);directives.directive("ngEnter",[function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}]),directives.directive("focus",["$timeout",function(a){return{scope:{focus:"@"},link:function(b,c){function d(){a(function(){c[0].focus()})}null!=b.focus?("false"!==b.focus&&d(),b.$watch("focus",function(a){"true"===a&&d()})):d()}}}]),directives.directive("cmlCodemirrorRefresh",["$timeout",function(a){return{restrict:"C",link:function(b,c,d){d.$observe("uiRefresh",function(d){b.$watch(d,function(b){a(function(){c.children()[0].CodeMirror.refresh()},100)})})}}}]),directives.directive("neatFileUploader",[function(){return{restrict:"E",replace:!0,scope:{uploader:"="},link:function(a,b,c){b.find("a").click(function(a){b.find('input[type="file"]').click()})},template:'<div class="file-uploader"><a href="#">Upload File<i class="icon_cloud-upload_alt"></i></a><input type="file" nv-file-select uploader="uploader" style="display: none;" /></div>'}}]),directives.directive("nanobar",["$log","$rootScope",function(a,b){return{restrict:"A",link:function(c,d,e){if(!Nanobar)return void a.error("Nanobar unavailable");var f,g,h={target:d.get(0),bg:"#5cb4ff"},i=new Nanobar(h),j=25;b.startNanobar=function(){if(i&&"function"==typeof i.go){f=20;var a=function(){i.go(f),f+=(100-f)/160,g=setTimeout(a,j)};g=setTimeout(a,j)}},b.finishNanobar=function(){clearTimeout(g),i.go(100)}}}}]);var filters=angular.module("filters",[]);filters.filter("isNotEmpty",[function(){var a;return function(b){for(a in b)if(b.hasOwnProperty(a))return!0;return!1}}]),filters.filter("truncate",[function(){return function(a,b){return a.length<=b?a:a.slice(0,b)+"..."}}]);var app=angular.module("app",["ngResource","ngCookies","ngAnimate","ui.codemirror","ui.bootstrap","ui.bootstrap.dropdown","ui.slider","angularFileUpload","services","controllers","filters","directives"]);app.config(["$httpProvider","$interpolateProvider","$resourceProvider",function(a,b,c){b.startSymbol("[["),b.endSymbol("]]"),c.defaults.stripTrailingSlashes=!1}]),app.run(["$http","$cookies",function(a,b){a.defaults.headers.post["X-CSRFToken"]=b.csrftoken,a.defaults.headers.put["X-CSRFToken"]=b.csrftoken,a.defaults.headers.common["X-CSRFToken"]=b.csrftoken}]);